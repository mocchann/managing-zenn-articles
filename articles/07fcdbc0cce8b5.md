---
title: "【MySQL】分離レベルと現象についてまとめる"
emoji: "🐬"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["データベース", "MySQL"]
published: false
---

## はじめに

とある日の業務中のこと、毎時1回動作するバッチにより生成されるテーブルのレコード件数が、**正しいときもあれば2倍になるときもある**という現象に出くわした

調査すると、以下のようにテーブルAから取得したデータを元に、新しくテーブルBのレコードを生成するという仕組みになっていることがわかった

* テーブルA
    * バッチAにより、毎時00分にレコード生成
* テーブルB
    * バッチBにより、毎時00分にテーブルAのレコードを元にテーブルBのレコードを生成

上記を踏まえて原因と想定されるのはおそらく**ダーティリード**だろうという結論になり、バッチの実行タイミングをズラすことで事象自体は解消した

しかし、MySQLの分離レベルについての理解がふわっとしているため記事にまとめておこうと思う

※参考書籍: https://www.shoeisha.co.jp/book/detail/9784798185330

## 分離レベルとは

ANSI(米国国家規格協会)と呼ばれる標準化組織が定義している

MySQLの場合、分離レベルと対応する現象は以下

| 分離レベル | ダーティリード | 曖昧な読取 | ファントム |
| ---- | ---- | ---- | ---- |
| リードアンコミッテッド | ◯ | ◯ | ◯ |
| リードコミッテッド | × | ◯ | ◯ |
| リピータブルリード | × | × | ◯ |
| シリアライザブル | × | × | × |

## 分離レベルごとに起こりうる現象

## 再現してみる

## おわりに
